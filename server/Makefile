.PHONY: dev dev-simple build test clean deps mock migrate-up migrate-down help

# é»˜è®¤ç›®æ ‡ - æ˜¾ç¤ºå¸®åŠ©
.DEFAULT_GOAL := help

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
help:
	@echo "EasySSH æœåŠ¡ç«¯ Makefile å‘½ä»¤:"
	@echo ""
	@echo "  make dev         - å¼€å‘æ¨¡å¼è¿è¡Œ (æ”¯æŒçƒ­é‡è½½)"
	@echo "  make dev-simple  - å¼€å‘æ¨¡å¼è¿è¡Œ (æ— çƒ­é‡è½½)"
	@echo "  make build       - æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶"
	@echo "  make test        - è¿è¡Œæµ‹è¯•"
	@echo "  make clean       - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  make deps        - å®‰è£…ä¾èµ–"
	@echo "  make mock        - ç”Ÿæˆ mock æ–‡ä»¶"
	@echo ""

# å¼€å‘æ¨¡å¼è¿è¡Œ - æ”¯æŒçƒ­é‡è½½
dev:
	@if [ -f /root/go/bin/air ]; then \
		/root/go/bin/air; \
	elif command -v air >/dev/null 2>&1; then \
		air; \
	else \
		echo "âš ï¸  Air æœªå®‰è£…,ä½¿ç”¨æ™®é€šæ¨¡å¼ (æ— çƒ­é‡è½½)"; \
		echo "ğŸ’¡ å®‰è£… Air: go install github.com/cosmtrek/air@latest"; \
		go run cmd/api/main.go; \
	fi

# å¼€å‘æ¨¡å¼è¿è¡Œ - æ— çƒ­é‡è½½
dev-simple:
	go run cmd/api/main.go

# æ„å»º
build:
	go build -o bin/easyssh-api cmd/api/main.go

# è¿è¡Œæµ‹è¯•
test:
	go test -v ./...

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	rm -rf bin/

# å®‰è£…ä¾èµ–
deps:
	go mod download
	go mod tidy

# ç”Ÿæˆ mock æ–‡ä»¶
mock:
	mockgen -source=internal/domain/repository.go -destination=internal/mock/repository.go

# æ•°æ®åº“è¿ç§»
migrate-up:
	# TODO: æ·»åŠ è¿ç§»å·¥å…·

migrate-down:
	# TODO: æ·»åŠ è¿ç§»å·¥å…·
